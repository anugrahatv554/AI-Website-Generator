<!DOCTYPE html>
<html>
<head>
  <title>AI Website Builder</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; }
    .output { margin-top: 20px; padding: 15px; background: #f4f4f4; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ðŸ§  AI Website Builder</h1>
  <form id="builderForm">
    <input type="text" id="businessType" placeholder="Business Type (e.g., Bakery)" required />
    <input type="text" id="industry" placeholder="Industry (e.g., Food)" required />
    <button type="submit">Generate Website</button>
  </form>

  <div class="output" id="output"></div>

  <script>
    document.getElementById("builderForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const businessType = document.getElementById("businessType").value;
      const industry = document.getElementById("industry").value;

      const response = await fetch("/api/generator/generate/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie('csrftoken')
        },
        body: JSON.stringify({ business_type: businessType, industry })
      });

      const data = await response.json();

      if (data.success) {
        window.location.href = "/api/generator/preview/";  // ðŸ‘ˆ Redirect after successful generation
      } else {
        document.getElementById("output").innerText = "Error generating website.";
      }
    });

    // CSRF token helper
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + "=")) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
</body>
</html>
